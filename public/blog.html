<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chocolate - Coffee Shop</title>

    <!-- UIKit CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.19.4/css/uikit.min.css"
    />

    <!-- Custom CSS Files - USANDO TUS ESTILOS EXACTOS -->
    <link rel="stylesheet" href="../assets/css/index.css" />
    <link rel="stylesheet" href="../assets/css/blog.css" />

    <!-- UIKit JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.19.4/js/uikit.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.19.4/js/uikit-icons.min.js"></script>
  </head>
  <body>
    <!-- Navbar - EXACTO AL ORIGINAL -->
    <div
      uk-sticky="sel-target: .uk-navbar-container; cls-active: uk-navbar-sticky"
    >
      <nav class="uk-navbar-container uk-navbar-transparent">
        <div class="uk-container uk-width-1-1 background-opaque">
          <div uk-navbar="mode: click" class="uk-flex">
            <!-- Navbar Left -->
            <div class="uk-navbar-left">
              <div class="uk-navbar-item uk-light">
                <a class="uk-flex uk-link-heading" href="/">
                  <img src="../assets/img/coffe-user-logo.svg" alt="Logo" />
                  <button
                    class="uk-margin-left uk-text-capitalize uk-text-left uk-text-small uk-button uk-button-link"
                  >
                    <strong
                      >Chocolate<br /><span id="current-user"
                        >Invitado</span
                      ></strong
                    >
                  </button>
                </a>
              </div>
            </div>

            <!-- Navbar Center -->
            <div class="uk-navbar-center uk-visible@l">
              <div class="uk-navbar-item uk-dark">
                <a
                  class="uk-button uk-button-secondary uk-border-rounded"
                  href="api.html"
                >
                  API
                </a>
              </div>
              <div class="uk-navbar-item uk-light">
                <a
                  class="uk-text-capitalize uk-button uk-button-text uk-light"
                  href="menu.html"
                >
                  Menú
                </a>
              </div>
              <div class="uk-navbar-item uk-light">
                <a
                  class="uk-text-capitalize uk-button uk-button-text"
                  href="recomendado.html"
                >
                  Recomendado
                </a>
              </div>
              <div class="uk-navbar-item uk-light">
                <a
                  class="uk-text-capitalize uk-button uk-button-text uk-light"
                  href="blog.html"
                >
                  Blog
                </a>
              </div>
              <div class="uk-navbar-item uk-light">
                <a
                  class="uk-text-capitalize uk-button uk-button-text uk-light"
                  href="nosotros.html"
                >
                  Nosotros
                </a>
              </div>
            </div>

            <!-- Navbar Right -->
            <div class="uk-navbar-right uk-visible@l">
              <div class="uk-navbar-item uk-light">
                <button
                  id="auth-btn"
                  class="uk-text-capitalize uk-text-normal uk-button uk-button-secondary uk-border-rounded"
                  onclick="toggleAuth()"
                >
                  Iniciar Sesión
                </button>
              </div>
              <div class="uk-navbar-item uk-dark">
                <a
                  class="uk-text-capitalize uk-button uk-button-secondary uk-border-rounded"
                  href="#"
                >
                  Registrarse
                </a>
              </div>
            </div>

            <!-- Mobile Menu Toggle -->
            <div class="uk-hidden@l uk-navbar-right">
              <a
                class="uk-navbar-toggle"
                uk-navbar-toggle-icon="true"
                uk-toggle="target: #burger-menu"
              ></a>

              <div id="burger-menu" uk-offcanvas="overlay: true; flip: true">
                <div class="uk-offcanvas-bar">
                  <button
                    class="uk-offcanvas-close"
                    type="button"
                    uk-close="true"
                  ></button>

                  <div
                    class="uk-flex uk-flex-column uk-grid-row-small uk-margin-medium-top"
                    uk-grid="true"
                  >
                    <div class="uk-flex-left">
                      <a
                        class="uk-button uk-button-secondary uk-border-rounded"
                        href="api.html"
                      >
                        <strong>API</strong>
                      </a>
                    </div>
                    <div class="uk-flex-left uk-margin-small-left">
                      <a
                        class="uk-text-capitalize uk-button uk-button-text uk-light"
                        href="menu.html"
                      >
                        Menú
                      </a>
                    </div>
                    <div class="uk-flex-left uk-margin-small-left">
                      <a
                        class="uk-text-capitalize uk-button uk-button-text"
                        href="recomendado.html"
                      >
                        Recomendado
                      </a>
                    </div>
                    <div class="uk-flex-left uk-margin-small-left">
                      <a
                        class="uk-text-capitalize uk-button uk-button-text uk-light"
                        href="blog.html"
                      >
                        Blog
                      </a>
                    </div>
                    <div class="uk-flex-left uk-margin-small-left">
                      <a
                        class="uk-text-capitalize uk-button uk-button-text uk-light"
                        href="nosotros.html"
                      >
                        Nosotros
                      </a>
                    </div>
                    <hr class="uk-divider-icon" />
                    <div class="uk-light">
                      <button
                        id="mobile-auth-btn"
                        class="uk-text-capitalize uk-text-normal uk-button uk-button-secondary uk-border-rounded uk-width-1-1"
                        onclick="toggleAuth()"
                      >
                        Iniciar Sesión
                      </button>
                    </div>
                    <div class="uk-dark">
                      <a
                        class="uk-text-capitalize uk-text-normal uk-button uk-button-secondary uk-border-rounded uk-width-1-1"
                        href="#"
                      >
                        Registrarse
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
    </div>

    <!-- Login Modal - EXACTO AL ORIGINAL -->
    <div id="login-modal" class="uk-modal blog-login-display">
      <div class="uk-modal-dialog uk-modal-body blog-login-container">
        <button
          class="uk-modal-close-default color-text-black"
          type="button"
          onclick="closeModal()"
          uk-close
        ></button>
        <h2 class="uk-modal-title color-text-black" id="modal-title">
          Iniciar Sesión
        </h2>

        <form class="uk-form-stacked" onsubmit="handleAuth(event)">
          <div class="uk-margin">
            <label class="uk-form-label color-text-black">Usuario</label>
            <input
              id="modal-username"
              class="uk-input blog-login-input"
              type="text"
              required
            />
          </div>
          <div class="uk-margin">
            <label class="uk-form-label color-text-black">Contraseña</label>
            <input
              id="modal-password"
              class="uk-input blog-login-input"
              type="password"
              required
            />
          </div>

          <div class="uk-flex uk-flex-between">
            <button
              class="uk-button uk-button-primary blog-container-round"
              type="submit"
              id="auth-submit-btn"
            >
              Iniciar Sesión
            </button>
            <button
              class="uk-button uk-button-link"
              type="button"
              onclick="toggleAuthMode()"
            >
              ¿No tienes cuenta?
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Main Content -->
    <main class="uk-section first-child-adjustment uk-dark blog-background">
      <div class="uk-container uk-text-default">
        <!-- Formulario para agregar nuevo blog - USANDO TUS ESTILOS EXACTOS -->
        <div
          class="uk-card uk-card-default uk-card-body uk-margin-bottom blog-container-round color-text-black blog-form-spacing"
        >
          <h3 class="uk-card-title">Agregar nuevo blog</h3>
          <form class="uk-grid-small" uk-grid id="blog-form">
            <div class="uk-width-1-2@s">
              <input
                class="uk-input"
                type="text"
                id="blog-title"
                placeholder="Título del blog"
                required
              />
            </div>
            <div class="uk-width-1-2@s">
              <input
                class="uk-input"
                type="text"
                id="blog-author"
                placeholder="Autor"
                required
              />
            </div>
            <div class="uk-width-1-1">
              <textarea
                class="uk-textarea"
                rows="3"
                id="blog-excerpt"
                placeholder="Resumen o introducción"
                required
              ></textarea>
            </div>
            <div class="uk-width-1-1">
              <input type="file" id="blog-image" accept="image/*" />
            </div>
            <div class="uk-width-1-1">
              <button
                type="submit"
                class="uk-button uk-button-secondary blog-container-round"
              >
                Publicar blog
              </button>
            </div>
          </form>
        </div>

        <!-- Container para mostrar blogs -->
        <div
          id="blogs-container"
          class="uk-child-width-1-2@s"
          uk-grid="masonry: pack"
        >
          <!-- Los blogs se insertarán aquí dinámicamente -->
        </div>
      </div>
    </main>

    <script>
      // Estado global para la funcionalidad del blog - REPLICANDO AuthContext.jsx
      let currentUser = null;
      let isRegistering = false;

      // Datos iniciales de blogs - EXACTOS AL COMPONENTE REACT
      let blogsData = [
        {
          id: 1,
          title: "5 Consejos para Mejorar tu Café Casero",
          author: "Natalia Ruiz",
          imageUrl: "../assets/img/blog/blog-example1.jpg",
          avatarUrl: "../assets/img/avatars/default.jpg",
          excerpt:
            "Descubre técnicas simples pero efectivas para preparar un mejor café en casa.",
        },
        {
          id: 2,
          title: "Guía Básica de Fotografía para Principiantes",
          author: "Kaleth Narváez",
          imageUrl: "../assets/img/blog/blog-example2.jpg",
          avatarUrl: "../assets/img/avatars/default.jpg",
          excerpt:
            "Aprende a sacar el máximo provecho de tu cámara desde el primer día.",
        },
      ];

      let visibleComments = {};
      let commentInputs = {};
      let commentsByBlog = {};

      // Función para login - IGUAL AL AuthContext
      function login(username) {
        currentUser = username;
        updateAuthState();
      }

      // Función para logout - IGUAL AL AuthContext
      function logout() {
        currentUser = null;
        updateAuthState();
      }

      // Función para mostrar el modal - IGUAL AL COMPONENTE REACT
      function showModal() {
        const modal = document.getElementById("login-modal");
        modal.classList.add("uk-open");
      }

      // Función para cerrar el modal - IGUAL AL COMPONENTE REACT
      function closeModal() {
        const modal = document.getElementById("login-modal");
        modal.classList.remove("uk-open");
        document.getElementById("modal-username").value = "";
        document.getElementById("modal-password").value = "";
      }

      // Función para alternar entre login y registro - IGUAL AL LoginModal.jsx
      function toggleAuthMode() {
        isRegistering = !isRegistering;
        const title = document.getElementById("modal-title");
        const submitBtn = document.getElementById("auth-submit-btn");
        const toggleBtn = document.querySelector(".uk-button-link");

        if (isRegistering) {
          title.textContent = "Registrarse";
          submitBtn.textContent = "Registrarse";
          toggleBtn.textContent = "¿Ya tienes cuenta?";
        } else {
          title.textContent = "Iniciar Sesión";
          submitBtn.textContent = "Iniciar Sesión";
          toggleBtn.textContent = "¿No tienes cuenta?";
        }
      }

      // Función para manejar autenticación - IGUAL AL LoginModal.jsx
      function handleAuth(event) {
        event.preventDefault();
        const username = document.getElementById("modal-username").value.trim();
        const password = document.getElementById("modal-password").value.trim();

        if (!username || !password) return;

        login(username);
        closeModal();
      }

      // Función para alternar comentarios - IGUAL AL COMPONENTE REACT
      function toggleComments(blogId) {
        visibleComments[blogId] = !visibleComments[blogId];
        renderBlogs();
      }

      // Función para manejar envío de comentario - IGUAL AL COMPONENTE REACT
      function handleCommentSubmit(blogId) {
        if (!currentUser) {
          UIkit.notification({
            message: "Debes iniciar sesión para comentar.",
            status: "warning",
            pos: "top-center",
          });
          showModal();
          return;
        }

        const commentText = commentInputs[blogId];
        if (!commentText || !commentText.trim()) {
          UIkit.notification({
            message: "Escribe un comentario válido.",
            status: "warning",
            pos: "top-center",
          });
          return;
        }

        const newComment = {
          text: commentText.trim(),
          author: currentUser,
        };

        if (!commentsByBlog[blogId]) {
          commentsByBlog[blogId] = [];
        }

        commentsByBlog[blogId].push(newComment);
        commentInputs[blogId] = "";

        UIkit.notification({
          message: "Comentario publicado.",
          status: "success",
          pos: "top-center",
        });
        renderBlogs();
      }

      // Función para manejar envío de blog - IGUAL AL COMPONENTE REACT
      function handleBlogSubmit(event) {
        event.preventDefault();

        if (!currentUser) {
          UIkit.notification({
            message: "Debes iniciar sesión para publicar un blog.",
            status: "warning",
            pos: "top-center",
          });
          showModal();
          return;
        }

        const title = document.getElementById("blog-title").value.trim();
        const author = document.getElementById("blog-author").value.trim();
        const excerpt = document.getElementById("blog-excerpt").value.trim();
        const imageFile = document.getElementById("blog-image").files[0];

        if (!title || !author || !excerpt) {
          UIkit.notification({
            message: "Todos los campos son obligatorios.",
            status: "warning",
            pos: "top-center",
          });
          return;
        }

        const blogToAdd = {
          id: Date.now(),
          title: title,
          author: currentUser,
          excerpt: excerpt,
          imageUrl: imageFile
            ? URL.createObjectURL(imageFile)
            : "../assets/img/blog/blogDefault.jpg",
          avatarUrl: "../assets/img/avatars/default.jpg",
        };

        blogsData.unshift(blogToAdd);

        // Limpiar formulario
        document.getElementById("blog-form").reset();

        UIkit.notification({
          message: "Blog publicado exitosamente.",
          status: "success",
          pos: "top-center",
        });
        renderBlogs();
      }

      // Función para renderizar blogs - ESTRUCTURA EXACTA AL JSX
      function renderBlogs() {
        const container = document.getElementById("blogs-container");
        container.innerHTML = "";

        blogsData.forEach((blog) => {
          const blogElement = document.createElement("div");
          blogElement.innerHTML = `
            <div class="uk-card uk-card-default uk-card-hover blog-container-round color-text-black">
                <div class="uk-card-media-top blog-image-container">
                    <button type="button" onclick="openImageModal(${blog.id})" 
                            style="border: none; background: transparent; padding: 0; cursor: pointer;">
                        <img src="${blog.imageUrl}" alt="${
            blog.title
          }" onerror="this.src='../assets/img/blog/blogDefault.jpg'">
                    </button>

                    <!-- Modal para imagen - IGUAL AL COMPONENTE REACT -->
                    <div id="modal-media-image-${
                      blog.id
                    }" class="uk-flex-top" uk-modal="true">
                        <div class="uk-modal-dialog uk-width-auto uk-margin-auto-vertical">
                            <button class="uk-modal-close-outside" type="button" uk-close="true"></button>
                            <img src="${blog.imageUrl}" alt="${blog.title}">
                        </div>
                    </div>
                </div>
                
                <div class="uk-card-body">
                    <h3 class="uk-card-title">${blog.title}</h3>
                    <p>${blog.excerpt}</p>
                    <div class="uk-flex uk-flex-middle uk-margin-small-top">
                        <img src="${blog.avatarUrl}" alt="${
            blog.author
          }" class="uk-border-circle" width="40" height="40">
                        <span class="uk-margin-small-left">${blog.author}</span>
                    </div>
                    <button class="uk-button uk-button-secondary uk-margin-small-top blog-container-round"
                            onclick="toggleComments(${blog.id})">
                        ${
                          visibleComments[blog.id]
                            ? "Cerrar comentarios"
                            : "Ver comentarios"
                        }
                    </button>

                    ${
                      visibleComments[blog.id]
                        ? `
                        <div class="uk-margin-top">
                            <div class="uk-flex uk-flex-middle uk-margin">
                                <img src="../assets/img/avatars/default.jpg" width="40" height="40" class="uk-border-circle" alt="Usuario">
                                <span class="uk-margin-left">${
                                  currentUser || "Invitado"
                                }</span>
                            </div>

                            <textarea class="uk-textarea uk-placeholder blog-login-input" rows="3" 
                                    placeholder="Escribe tu comentario..." 
                                    id="comment-input-${blog.id}"
                                    onchange="handleCommentChange(${
                                      blog.id
                                    }, this.value)"></textarea>

                            <button class="uk-button uk-button-primary uk-margin-top blog-container-round"
                                    onclick="handleCommentSubmit(${blog.id})">
                                Comentar
                            </button>

                            ${renderComments(blog.id)}
                        </div>
                    `
                        : ""
                    }
                </div>
            </div>
        `;
          container.appendChild(blogElement);
        });
      }

      // Función para renderizar comentarios - ESTRUCTURA EXACTA AL JSX
      function renderComments(blogId) {
        const comments = commentsByBlog[blogId] || [];
        return comments
          .map(
            (comment, index) => `
        <article class="uk-comment uk-margin-top">
            <header class="uk-comment-header uk-flex uk-flex-middle">
                <img class="uk-comment-avatar uk-border-circle" src="../assets/img/avatars/default.jpg" 
                     width="40" height="40" alt="${comment.author}">
                <div class="uk-margin-small-left">
                    <h4 class="uk-comment-title uk-margin-remove color-text-black">${comment.author}</h4>
                    <ul class="uk-comment-meta uk-subnav uk-subnav-divider uk-margin-remove-top">
                        <li><span class="color-text-black">Hace un momento</span></li>
                    </ul>
                </div>
            </header>
            <div class="uk-comment-body">
                <p>${comment.text}</p>
            </div>
        </article>
    `
          )
          .join("");
      }

      // Función para manejar cambio de comentarios
      function handleCommentChange(blogId, value) {
        commentInputs[blogId] = value;
      }

      // Función para abrir modal de imagen - IGUAL AL COMPONENTE REACT
      function openImageModal(blogId) {
        const modal = UIkit.modal(
          document.getElementById(`modal-media-image-${blogId}`)
        );
        if (modal) modal.show();
      }

      // Función para manejar autenticación desde el navbar - IGUAL AL COMPONENTE REACT
      function toggleAuth() {
        if (currentUser) {
          logout();
        } else {
          showModal();
        }
      }

      // Función para actualizar el estado de la UI - IGUAL AL AuthContext
      function updateAuthState() {
        const authBtn = document.getElementById("auth-btn");
        const mobileAuthBtn = document.getElementById("mobile-auth-btn");
        const currentUserSpan = document.getElementById("current-user");

        if (authBtn) {
          authBtn.textContent = currentUser
            ? "Cerrar Sesión"
            : "Iniciar Sesión";
        }

        if (mobileAuthBtn) {
          mobileAuthBtn.textContent = currentUser
            ? "Cerrar Sesión"
            : "Iniciar Sesión";
        }

        if (currentUserSpan) {
          currentUserSpan.textContent = currentUser || "Invitado";
        }
      }

      // Event Listeners
      document.addEventListener("DOMContentLoaded", function () {
        // Renderizar blogs iniciales
        renderBlogs();

        // Event listener para el formulario de blog
        document
          .getElementById("blog-form")
          .addEventListener("submit", handleBlogSubmit);

        // Sincronizar con el estado de autenticación del navbar si existe
        const currentUserSpan = document.getElementById("current-user");
        if (currentUserSpan && currentUserSpan.textContent !== "Invitado") {
          currentUser = currentUserSpan.textContent;
        }

        updateAuthState();
      });
    </script>

    <!-- Footer - EXACTO AL ORIGINAL -->
    <footer
      class="uk-section uk-section-small"
      style="background-color: #2f2c2c; width: 100%; z-index: 10"
    >
      <div class="uk-container">
        <div
          class="uk-flex uk-flex-between uk-flex-middle uk-grid-small"
          uk-grid=""
        >
          <div>
            <img src="../assets/img/coffe-user-logo.svg" alt="Logo" />
          </div>
          <div class="uk-text-top">
            <span class="uk-text-small uk-text-muted">Síguenos</span>
            <div class="uk-margin-small-top">
              <a
                href="https://www.x.com"
                class="uk-icon-button"
                uk-icon="icon: x"
                target="_blank"
              ></a>
              <a
                href="https://www.instagram.com"
                class="uk-icon-button uk-margin-small-left"
                uk-icon="icon: instagram"
                target="_blank"
              ></a>
              <a
                href="https://www.youtube.com"
                class="uk-icon-button uk-margin-small-left"
                uk-icon="icon: youtube"
                target="_blank"
              ></a>
              <a
                href="https://www.linkedin.com"
                class="uk-icon-button uk-margin-small-left"
                uk-icon="icon: linkedin"
                target="_blank"
              ></a>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script>
      // Estado global exactamente como el AuthContext
      let currentUser = null;
      let isRegistering = false;

      // Función para manejar autenticación (login/logout)
      function toggleAuth() {
        if (currentUser) {
          logout();
        } else {
          showModal();
        }
      }

      // Función para mostrar el modal
      function showModal() {
        document.getElementById("login-modal").classList.add("uk-open");
      }

      // Función para cerrar el modal
      function closeModal() {
        document.getElementById("login-modal").classList.remove("uk-open");
        // Reset form
        document.getElementById("modal-username").value = "";
        document.getElementById("modal-password").value = "";
      }

      // Función para alternar entre login y registro
      function toggleAuthMode() {
        isRegistering = !isRegistering;
        const title = document.getElementById("modal-title");
        const submitBtn = document.getElementById("auth-submit-btn");
        const toggleBtn = document.querySelector(".uk-button-link");

        if (isRegistering) {
          title.textContent = "Registrarse";
          submitBtn.textContent = "Registrarse";
          toggleBtn.textContent = "¿Ya tienes cuenta?";
        } else {
          title.textContent = "Iniciar Sesión";
          submitBtn.textContent = "Iniciar Sesión";
          toggleBtn.textContent = "¿No tienes cuenta?";
        }
      }

      // Función para manejar el envío del formulario
      function handleAuth(event) {
        event.preventDefault();
        const username = document.getElementById("modal-username").value.trim();
        const password = document.getElementById("modal-password").value.trim();

        if (!username || !password) return;

        // Simular login/registro (como en el original)
        login(username);
        closeModal();
      }

      // Función para login
      function login(username) {
        currentUser = username;
        updateAuthState();
      }

      // Función para logout
      function logout() {
        currentUser = null;
        updateAuthState();
      }

      // Función para actualizar el estado de la UI
      function updateAuthState() {
        const authBtn = document.getElementById("auth-btn");
        const mobileAuthBtn = document.getElementById("mobile-auth-btn");
        const currentUserSpan = document.getElementById("current-user");

        if (currentUser) {
          authBtn.textContent = "Cerrar Sesión";
          mobileAuthBtn.textContent = "Cerrar Sesión";
          currentUserSpan.textContent = currentUser;
        } else {
          authBtn.textContent = "Iniciar Sesión";
          mobileAuthBtn.textContent = "Iniciar Sesión";
          currentUserSpan.textContent = "Invitado";
        }
      }

      // Inicializar cuando se carga la página
      document.addEventListener("DOMContentLoaded", function () {
        updateAuthState();
      });
    </script>
  </body>
</html>
